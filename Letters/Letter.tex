\documentclass[12pt]{article}

\usepackage{polyglossia}
\setmainlanguage{russian}
\setotherlanguage{english}

\newfontfamily\russianfont[Script=Cyrillic]{Times New Roman}

\usepackage[c5paper,landscape]{geometry}
%\usepackage{showframe}
\usepackage{color}
\usepackage{graphicx}
\usepackage[absolute]{textpos}
\usepackage{pict2e}
\usepackage{xstring}

\setlength{\TPVertModule}{1mm}
\setlength{\TPHorizModule}{1mm}

\textblockorigin{0mm}{0mm}
\setlength{\parindent}{0mm}
\linespread{1.27}

\setlength{\unitlength}{1mm}

\input{digits}

\newcommand\markspot{
\begin{textblock}{15}(199,17)
\begin{picture}(15,15)(0,0)
\color{blue}{\put(0,15){\line(1,0){15}}}%
\color{blue}{\put(15,15){\line(0,-1){15}}}%
\end{picture}
\end{textblock}
}

\newcommand\fromlines{
\begin{textblock}{85}(10,17)
\begin{picture}(85,34)(0,0)
\color{blue}{\put(17,30.7){\line(1,0){68}}}%
\color{blue}{\put(17,24.2){\line(1,0){68}}}%
\color{blue}{\put(0,17.7){\line(1,0){85}}}%
\color{blue}{\put(0,11.2){\line(1,0){85}}}%
\color{blue}{\put(50,11.2){\line(0,-1){8}}}%
\color{blue}{\put(85,11.2){\line(0,-1){8}}}%
\color{blue}{\put(50,3.2){\line(1,0){35}}}%
\color{blue}{\put(50,9.2){\makebox[35mm][c]{\textit{\tiny{Индекс места отправления}}}}}
\end{picture}
\end{textblock}
}

\newcommand\fromtext[3]{
\fromlines
\begin{textblock}{85}(10,17)
\makebox[16mm][l]{\textit{\textbf{От кого}}} {#1}%
\end{textblock}
\begin{textblock}{85}(10,23.5)
\makebox[16mm][l]{\textit{\textbf{Откуда}}} {#2}%
\end{textblock}
\begin{textblock}{35}(60,43)
\makebox[35mm][c]{\large #3}
\end{textblock}
}

\newcommand\tolines{
\begin{textblock}{100}(110,98)
\begin{picture}(100,47)(0,0)
\color{blue}{\put(12,43.7){\line(1,0){88}}}%
\color{blue}{\put(0,37.2){\line(1,0){100}}}%
\color{blue}{\put(12,30.7){\line(1,0){88}}}%
\color{blue}{\put(0,24.2){\line(1,0){100}}}%
\color{blue}{\put(0,17.7){\line(1,0){100}}}%
\color{blue}{\put(0,11.2){\line(1,0){100}}}%
\color{blue}{\put(0,11.2){\line(0,-1){8}}}%
\color{blue}{\put(40,11.2){\line(0,-1){8}}}%
\color{blue}{\put(0,3.2){\line(1,0){40}}}%
\color{blue}{\put(0,11.7){\makebox[40mm][c]{\textit{\tiny{Индекс места назначения}}}}}
\end{picture}
\end{textblock}
}

\newcommand\totext[8]{
\markspot
\digitstr{#3}{#4}{#5}{#6}{#7}{#8}
\tolines
\begin{textblock}{100}(110,98)
\makebox[11mm][l]{\textit{\textbf{Кому}}} {#1}%
\end{textblock}
\begin{textblock}{100}(110,111)
\makebox[11mm][l]{\textit{\textbf{Куда}}} {#2}%
\end{textblock}
\begin{textblock}{40}(110,135.5)
\makebox[40mm][c]{\Large {#3}{#4}{#5}{#6}{#7}{#8}}
\end{textblock}
}

\begin{document}
\thispagestyle{empty}

\fromtext{Цыбулина Ивана Владимировича}{Россия, Московская обл., г. Долгопрудный, ул. Первомайская, д. 32, корп. 4, кв. 153, общежитие МФТИ №10}{141701}

\input{defs}

\totext{\recpt}{\addr}{\idxaaa}{\idxaab}{\idxaba}{\idxabb}{\idxbaa}{\idxbab}

\end{document}
